@model AWEElectronics.DTO.User

@{
    ViewBag.Title = "Edit User";
}

<div class="row mb-4">
    <div class="col-12">
        <h2><i class="fas fa-user-edit"></i> Edit User</h2>
        <p class="text-muted">Update user information</p>
    </div>
</div>

@if (ViewBag.ErrorMessage != null)
{
    <div class="alert alert-danger alert-dismissible fade show">
        <i class="fas fa-exclamation-circle"></i> @ViewBag.ErrorMessage
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

<div class="row">
    <div class="col-md-8 col-lg-6">
        <div class="card shadow">
            <div class="card-body">
                <form method="post" action="@Url.Action("Edit", "Users", new { id = Model.UserID })">
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="UserID" value="@Model.UserID" />
                    <input type="hidden" name="Username" value="@Model.Username" />
                    <input type="hidden" name="PasswordHash" value="@Model.PasswordHash" />
                    <input type="hidden" name="CreatedDate" value="@Model.CreatedDate" />
                    <input type="hidden" name="CreatedAt" value="@Model.CreatedAt" />

                    <div class="mb-3">
                        <label class="form-label">Username</label>
                        <input type="text" class="form-control" value="@Model.Username" disabled>
                        <div class="form-text">Username cannot be changed</div>
                    </div>

                    <div class="mb-3">
                        <label for="FullName" class="form-label">Full Name <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="FullName" name="FullName"
                               value="@Model.FullName" required
                               placeholder="Enter full name">
                    </div>

                    <div class="mb-3">
                        <label for="Email" class="form-label">Email <span class="text-danger">*</span></label>
                        <input type="email" class="form-control" id="Email" name="Email"
                               value="@Model.Email" required
                               placeholder="email@example.com">
                    </div>

                    <div class="mb-3">
                        <label for="Phone" class="form-label">Phone</label>
                        <input type="tel" class="form-control" id="Phone" name="Phone"
                               value="@Model.Phone"
                               placeholder="Enter phone number (optional)">
                    </div>

                    <div class="mb-3">
                        <label for="Role" class="form-label">Role <span class="text-danger">*</span></label>
                        <select class="form-select" id="Role" name="Role" required>
                            @foreach (var role in ViewBag.Roles as List<string>)
                            {
                                <option value="@role" @(Model.Role == role ? "selected" : "")>@role</option>
                            }
                        </select>
                        <div class="form-text">
                            <strong>Admin:</strong> Full system access |
                            <strong>Staff:</strong> General operations |
                            <strong>Accountant:</strong> Financial access |
                            <strong>Agent:</strong> Sales operations
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="Status" class="form-label">Status <span class="text-danger">*</span></label>
                        <select class="form-select" id="Status" name="Status" required>
                            @foreach (var status in ViewBag.Statuses as List<string>)
                            {
                                <option value="@status" @(Model.Status == status ? "selected" : "")>@status</option>
                            }
                        </select>
                    </div>

                    <hr class="my-4">

                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i> To change the password, use the
                        <a href="@Url.Action("ChangePassword", "Users", new { id = Model.UserID })" class="alert-link">Change Password</a> feature.
                    </div>

                    <div class="d-grid gap-2 d-md-flex justify-content-md-between mt-4">
                        <a href="@Url.Action("Index", "Users")" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Cancel
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="col-md-4 col-lg-6">
        <div class="card shadow">
            <div class="card-header bg-light">
                <h6 class="mb-0"><i class="fas fa-info-circle"></i> User Information</h6>
            </div>
            <div class="card-body">
                <dl class="row mb-0">
                    <dt class="col-sm-5">User ID:</dt>
                    <dd class="col-sm-7">@Model.UserID</dd>

                    <dt class="col-sm-5">Created Date:</dt>
                    <dd class="col-sm-7">@Model.CreatedDate.ToString("MMM dd, yyyy")</dd>

                    @if (Model.LastLogin.HasValue)
                    {
                        <dt class="col-sm-5">Last Login:</dt>
                        <dd class="col-sm-7">@Model.LastLogin.Value.ToString("MMM dd, yyyy HH:mm")</dd>
                    }
                    else
                    {
                        <dt class="col-sm-5">Last Login:</dt>
                        <dd class="col-sm-7"><span class="text-muted">Never logged in</span></dd>
                    }
                </dl>
            </div>
        </div>
    </div>
</div>
